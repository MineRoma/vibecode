#!/bin/bash

SITE_NAME="my_php_website"
DOMAIN_NAME="mineroma.work.gd"
WEB_ROOT="/var/www/html/$SITE_NAME"
PHP_VERSION="8.1"

echo "üìù –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–º try_files..."

NGINX_CONF="/etc/nginx/sites-available/$SITE_NAME"
sudo bash -c "cat <<EOF > $NGINX_CONF
server {
    listen 80;
    server_name $DOMAIN_NAME www.$DOMAIN_NAME 62.60.187.58;

    root $WEB_ROOT;
    index index.php index.html index.htm;

    # –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
    location / {
        try_files \$uri \$uri/ =404;
    }

    # Pass PHP scripts to FPM
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php${PHP_VERSION}-fpm.sock;
        fastcgi_param SCRIPT_FILENAME \$document_root\$fastcgi_script_name;
    }

    # –°–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤ .htaccess –∏ .htpasswd
    location ~ /\.ht {
        deny all;
    }
}
EOF"

echo "üîó –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å–∞–π—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞..."
sudo ln -s $NGINX_CONF /etc/nginx/sites-enabled/

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
sudo nginx -t
sudo systemctl restart nginx

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å Certbot."
